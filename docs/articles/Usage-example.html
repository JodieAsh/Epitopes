<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Usage example â€¢ epitopes</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Usage example">
<meta property="og:description" content="epitopes">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epitopes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.9018</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Usage-example.html">Usage example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fcampelo/epitopes/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Usage example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/fcampelo/epitopes/blob/HEAD/vignettes/Usage-example.Rmd" class="external-link"><code>vignettes/Usage-example.Rmd</code></a></small>
      <div class="hidden name"><code>Usage-example.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document illustrates an example of how the <code>epitopes</code> package can be used to create an organism-specific epitope predictor.</p>
</div>
<div class="section level2">
<h2 id="initial-setup">Initial setup:<a class="anchor" aria-label="anchor" href="#initial-setup"></a>
</h2>
<p>The <code>epitopes</code> package provides functions to download, extract, consolidate and pre-process epitope data from the <a href="http://www.iedb.org/" class="external-link">Immune Epitope Database (IEDB)</a>, together with protein data (retrieved from NCBI and Uniprot) and taxonomy information for each pathogen (also from NCBI).</p>
<p>This initial part is quite time-consuming, but it only needs to be done once, at the start of any project (or possibly once every few months, to get updated versions of the database). Once these are retrieved and saved, they can be loaded using simple <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS()</a></code> calls.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># library(epitopes)</span>
<span class="co"># </span>
<span class="co"># # Download the full IEDB export into a given folder "XYZ"</span>
<span class="co"># epitopes::get_IEDB(save_folder = "XYZ")</span>
<span class="co"># </span>
<span class="co"># # Extract only the linear B-cell epitopes from the IEDB export and save the </span>
<span class="co"># # result to folder "ABC"</span>
<span class="co"># epitopes &lt;- epitopes::get_LBCE(data_folder = "XYZ", </span>
<span class="co">#                                ncpus = parallel::detectCores() - 2,</span>
<span class="co">#                                save_folder = "ABC")</span>
<span class="co"># </span>
<span class="co"># # Retrieve the relevant proteins and save them into the same folder "ABC"</span>
<span class="co"># proteins &lt;- epitopes::get_proteins(uids = unique(epitopes$protein_id),</span>
<span class="co">#                                    save_folder = "ABC")</span>
<span class="co"># </span>
<span class="co"># # Retrieve a taxonomy list for all pathogens and save it into the same folder "ABC"</span>
<span class="co"># taxonomy &lt;- epitopes::get_taxonomy(uids = unique(c(epitopes$sourceOrg_id,</span>
<span class="co">#                                                    epitopes$host_id)),</span>
<span class="co">#                                    save_folder = "ABC")</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage-pipeline">Usage Pipeline<a class="anchor" aria-label="anchor" href="#usage-pipeline"></a>
</h2>
<p>Functions in the <em>epitopes</em> package are designed to work well with <em>dplyr</em> pipelines. To go from the initial files to a data structure containing the the data splits (training / hold-out, cross-validation folds or any other data splitting required) and the desired local and global features, just follow the example below:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fcampelo/epitopes" class="external-link">epitopes</a></span><span class="op">)</span>

<span class="va">epitopes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"./data/epitopes.rds"</span><span class="op">)</span> <span class="co"># Generated by get_IEDB() -&gt; get_LBCE()</span>
<span class="va">proteins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"./data/proteins.rds"</span><span class="op">)</span> <span class="co"># Generated by get_proteins()</span>
<span class="va">taxonomy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"./data/taxonomy.rds"</span><span class="op">)</span> <span class="co"># Generated by get_taxonomy()</span>

<span class="va">orgID</span> <span class="op">&lt;-</span> <span class="fl">10376</span> <span class="co"># Taxonomy ID for the Epstein-Barr virus</span>
<span class="va">ncpus</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span>

<span class="va">peptides.list</span> <span class="op">&lt;-</span> <span class="va">epitopes</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/filter_epitopes.html">filter_epitopes</a></span><span class="op">(</span>orgIDs        <span class="op">=</span> <span class="va">orgID</span>, <span class="co"># &lt;--- Filter entries by organism ID</span>
                  tax_list      <span class="op">=</span> <span class="va">taxonomy</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/consolidate_data.html">consolidate_data</a></span><span class="op">(</span><span class="va">proteins</span>, 
                   only_exact <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># &lt;----- Also include 'epitope containing regions'</span>
                   ncpus <span class="op">=</span> <span class="va">ncpus</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/extract_peptides.html">extract_peptides</a></span><span class="op">(</span>min_peptide <span class="op">=</span> <span class="fl">8</span>, <span class="co"># &lt;-------- shortest labelled peptide considered (regardles of Class)</span>
                   max_epitope <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># &lt;--- longest positively-labelled entry considered</span>
  <span class="fu"><a href="../reference/make_data_splits.html">make_data_splits</a></span><span class="op">(</span>proteins     <span class="op">=</span> <span class="va">proteins</span>,
                   target_props <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="fl">.75</span><span class="op">)</span>, <span class="co"># &lt;-- desired split proportions</span>
                   similarity_threshold <span class="op">=</span> <span class="fl">.6</span>,  <span class="co"># &lt;-- proteins more similar than this are always placed in the same split.</span>
                   ncpus <span class="op">=</span> <span class="va">ncpus</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/calc_features.html">calc_features</a></span><span class="op">(</span>
    <span class="co"># local features are calculated for the local windows and added to peptides.list$df</span>
    local.features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Entropy"</span>,<span class="st">"MolWeight"</span>, <span class="st">"AAtypes"</span>, <span class="st">"Atoms"</span>, <span class="st">"AAC"</span>, <span class="st">"CTDC"</span>, <span class="st">"CTDD"</span>, <span class="st">"CTDT"</span>, <span class="st">"BLOSUM"</span><span class="op">)</span>, 
    <span class="co"># global features are calculated at the full protein level and added to peptides.list$proteins (needs a data join on df later, before training the models)</span>
    global.features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AAC"</span>, <span class="st">"DC"</span>, <span class="st">"CTDC"</span>, <span class="st">"CTDD"</span>, <span class="st">"CTDT"</span>, <span class="st">"CTriad"</span>, <span class="st">"SOCN"</span>, <span class="st">"Entropy"</span>, <span class="st">"MolWeight"</span>, <span class="st">"AAtypes"</span><span class="op">)</span>,
    ncpus <span class="op">=</span> <span class="va">ncpus</span><span class="op">)</span></code></pre></div>
<p>The resulting <code>peptides.list</code> contains information not only about the results, but also the function parameters used at each step:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">names</span>(peptides.list)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"df"</span>                <span class="st">"peptides"</span>          <span class="st">"filter.attrs"</span>      <span class="st">"consolidate.attrs"</span> <span class="st">"peptide.attrs"</span>    </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">6</span>] <span class="st">"proteins"</span>          <span class="st">"splits.attrs"</span>      <span class="st">"feature.attrs"</span></span></code></pre></div>
<ul>
<li>
<code>df</code> contains the labelled entries by protein position, plus the local feature columns and the split information</li>
<li>
<code>proteins</code> contains the protein data, plus the global feature columns</li>
<li>
<code>peptides</code> contains a summary of the labelled peptides in the data</li>
<li>
<code>filter.attrs</code>, <code>consolidate.attrs</code>, <code>peptide.attrs</code> and <code>feature.attrs</code> contain information about the parameters used for <code><a href="../reference/filter_epitopes.html">filter_epitopes()</a></code>, <code><a href="../reference/consolidate_data.html">consolidate_data()</a></code>, <code><a href="../reference/extract_peptides.html">extract_peptides()</a></code> and <code><a href="../reference/calc_features.html">calc_features()</a></code>.</li>
<li>
<code>splits.attrs</code> contains information about the parameters used for <code><a href="../reference/make_data_splits.html">make_data_splits()</a></code>, together with relevant quantities calculated as part of that routine (clusters identified, similarity matrices, cluster allocation to splits, etc.)</li>
</ul>
<p>For more information please refer to the documentation of the specific functions used above.</p>
</div>
<div class="section level2">
<h2 id="exporting-data">Exporting data<a class="anchor" aria-label="anchor" href="#exporting-data"></a>
</h2>
<p>Function <code><a href="../reference/save_peptide_list.html">save_peptide_list()</a></code> is available to to export the full information from objects of type <code>peptide.list</code> (e.g., output of <code><a href="../reference/extract_peptides.html">extract_peptides()</a></code>, <code><a href="../reference/make_data_splits.html">make_data_splits()</a></code> or <code><a href="../reference/calc_features.html">calc_features()</a></code>) to a set of CSV files (plus a single RDS file with the clustering structure calculated in <code><a href="../reference/make_data_splits.html">make_data_splits()</a></code>) for easier sharing and cross-platform use.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Felipe Campelo.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
