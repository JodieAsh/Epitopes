<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fit Random Forest model to epitope data — fit_model • epitopes</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fit Random Forest model to epitope data — fit_model"><meta property="og:description" content="Fits a Random Forest model to epitope data, using the data splits and
features previously calculated using make_data_splits() and
calc_features(), respectively."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epitopes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.9018</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Usage-example.html">Usage example</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/fcampelo/epitopes/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit Random Forest model to epitope data</h1>
    <small class="dont-index">Source: <a href="https://github.com/fcampelo/epitopes/blob/HEAD/R/fit_model.R" class="external-link"><code>R/fit_model.R</code></a></small>
    <div class="hidden name"><code>fit_model.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fits a Random Forest model to epitope data, using the data splits and
features previously calculated using <code><a href="make_data_splits.html">make_data_splits()</a></code> and
<code><a href="calc_features.html">calc_features()</a></code>, respectively.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">fit_model</span><span class="op">(</span>
  <span class="va">peptides.list</span>,
  threshold <span class="op">=</span> <span class="fl">0.5</span>,
  holdout.split <span class="op">=</span> <span class="cn">NULL</span>,
  CV.folds <span class="op">=</span> <span class="cn">NULL</span>,
  sample.rebalancing <span class="op">=</span> <span class="st">"undersampling"</span>,
  use.global.features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">peptides.list</span><span class="op">$</span><span class="va">splits.attrs</span><span class="op">$</span><span class="va">split_level</span> <span class="op">==</span> <span class="st">"protein"</span>,
    <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>,
  return.model <span class="op">=</span> <span class="st">"full"</span>,
  ncpus <span class="op">=</span> <span class="fl">1</span>,
  rnd.seed <span class="op">=</span> <span class="cn">NULL</span>,
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>peptides.list</dt>
<dd><p>data frame containing the training data (one or more
numerical predictors and one <strong>Class</strong> attribute).</p></dd>
<dt>threshold</dt>
<dd><p>probability threshold for attributing a prediction as
<em>positive</em>.</p></dd>
<dt>holdout.split</dt>
<dd><p>name of split to be used as a holdout set. If <code>NULL</code>
then the full data is used for training. Ignored if <code>CV.folds</code> is not <code>NULL</code>.</p></dd>
<dt>CV.folds</dt>
<dd><p>vector with the names of the splits to be used for cross validation.
If <code>NULL</code> no cross-validation is performed.</p></dd>
<dt>sample.rebalancing</dt>
<dd><p>character: should the model try to compensate class
imbalances during training? See <strong>Dealing with class imbalance</strong> for details.</p></dd>
<dt>use.global.features</dt>
<dd><p>logical: should global features (potentially
available in <code>peptides.list$proteins</code>) be used? Should be left as the default
unless the user knows exactly what they're doing. See <strong>Details</strong>.</p></dd>
<dt>return.model</dt>
<dd><p>model to be returned. Accepts <code>"full"</code> (return model
trained on the full data); <code>"partial"</code> (model trained on all data except the
holdout split; or on the set of data specified in all CV folds); or <code>"none"</code>
(does not return a model).</p></dd>
<dt>ncpus</dt>
<dd><p>number of cores to use.</p></dd>
<dt>rnd.seed</dt>
<dd><p>seed for random number generator.</p></dd>
<dt>...</dt>
<dd><p>other options to be passed down to <code><a href="https://rdrr.io/pkg/ranger/man/ranger.html" class="external-link">ranger::ranger()</a></code>.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>List containing the fitted model and several performance indicators.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Function <code><a href="make_data_splits.html">make_data_splits()</a></code> defines data splits based on (protein or
peptide) similarity. The split identifiers are stored in
<code>peptides.list$df$Info_split</code>. Function <code><a href="calc_features.html">calc_features()</a></code> calculates
the local and/or global features for each entry. Local features are stored in
<code>peptides.list$df</code> as columns starting with <code>feat_local_</code>, whereas global
features are stored in <code>peptides.list$proteins</code>, as columns starting with
<code>feat_global_</code>.
<strong>NOTE</strong>: Global features should only be used if the splitting level
used was "protein", otherwise they may cause contamination of performance
assessment due to data leakage. The splitting level of the data can be
checked on <code>peptides.list$splits.attrs$split_level</code>.</p>
    </div>
    <div id="dealing-with-class-imbalance">
    <h2>Dealing with class imbalance</h2>
    

<p>Parameter <code>sample.rebalancing</code> regulates how the modelling routine attempts
to compensate class imbalances. The following strategies are available:</p><ul><li><p><code>"undersampling"</code> (default) : stratified undersampling of the
majority class. The undersampling is performed in a
manner that retains at least some observations related to each peptide
from the majority class (plus all observations from the minority class).</p></li>
<li><p><code>"by_tree"</code>: sets the parameter <code>case.weights</code> of
<code><a href="https://rdrr.io/pkg/ranger/man/ranger.html" class="external-link">ranger::ranger()</a></code> to give each observation a sampling probability
inversely proportional to its class prevalence.</p></li>
<li><p>any other value: no rebalancing is done.</p></li>
</ul></div>
    <div id="performance-assessment">
    <h2>Performance assessment</h2>
    

<p>This function has the following modes of performance assessment:</p>
<ul><li><p>If both <em>holdout.split</em> and <em>CV.folds</em> are <code>NULL</code>, no performance
assessment is done. A model is fit on the full data and returned.</p></li>
<li><p>If <em>holdout.split</em> is the valid name of a data split in
<code>peptides.list$df$Info_split</code> <strong>AND</strong> <em>CV.folds</em> is <code>NULL</code>, a model is
trained on the full data except the <em>holdout.split</em> and then applied to
predict the labels for <em>holdout.split</em>. The performance returned
corresponds to the performance on <em>holdout.split</em>.</p></li>
<li><p>If <em>CV.folds</em> is a vector of valid names of data splits in
<code>peptides.list$df$Info_split</code>, the splits named are used as
cross-validation folds. The performance returned
corresponds to the average cross-validation performance using the
<em>CV.folds</em>. If <em>CV.folds</em> is not <code>NULL</code> the value of
<em>holdout.split</em> is ignored.</p></li>
</ul><p><strong>IMPORTANT</strong>: by default, the model returned by this routine is a model
trained on the <strong>full data</strong> (fit after the performance is assessed on
holdout splits or on cross-validation folds). This can be regulated by
parameter <code>return.model</code>.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Felipe Campelo (<a href="mailto:f.campelo@aston.ac.uk">f.campelo@aston.ac.uk</a>)</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Felipe Campelo.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

